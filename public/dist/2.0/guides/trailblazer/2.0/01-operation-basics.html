<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Trailblazer: 01- Operation Basics</title>
<meta name="description" content="01- Operation Basics - Trailblazer">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content=", ">

<!-- style -->
<link rel="shortcut icon" href="../../../favicon.ico">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,%20400,700,800%7CRaleway:400,200,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../css/application.css">

<!-- script -->
<script src="../../../javascripts/jquery.min.js"></script>
<script src="../../../javascripts/application.min.js"></script>
<script>
  jQuery(document).ready(function($) {
    $(document).foundation();

    anchors.add("article h2");
    anchors.add("article h3");

    hljs.configure({
      languages: ['ruby', 'haml']
    });

    hljs.initHighlightingOnLoad();

    // $('#code-slider').slick({arrows: true, dots: true});
    $('.carousel').slick({arrows: true, dots: true});
  });
</script>


<meta property="og:title" content="01- Operation Basics">
<meta property="og:site_name" content="Trailblazer">
<meta property="og:url" content="http://trailblazer.to/guides/trailblazer/2.0/01-operation-basics.html">
<meta property="og:description" content="">
<meta property="og:image" content="http://trailblazer.to/images/go-trailblazer.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@apotonick">
<meta name="twitter:title" content="01- Operation Basics">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="http://trailblazer.to/images/go-trailblazer.jpg">

  </head>
  <body>


  <!--
    <div class="secondary callout" data-closable>
      <strong>TRB JOBS:</strong> Deutschsprachiger Ruby Developer in Hannover - <a href="/inc/jobs.html">Jaaaa!</a>
      <button class="close-button" aria-label="Dismiss alert" type="button" data-close>
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  -->

      <a class="notice" style="display: block; overflow: hidden; position: relative; width: 100%; padding: 0.6rem 0; background-color: #3b5998;" href="http://fb.me/trailblazer.to">
    <div class="info" style="text-align: center;">
      <h5 style="font-size: 0.9rem; color: white; font-weight: bold;">
        <i class="fa fa-facebook-square" aria-hidden="true" style="font-size: 1.2rem;"></i>
        LIKE US FOR UPDATES + GET A FREE STICKER PACK!
      </h5>
    </div>
  </a>


    <div data-sticky-container class="top-navbar">
  <div class="top-bar sticky" data-sticky data-options="marginTop:0;" style="width:100%">
    <div class="top-bar-title">
      <ul class="menu horizontal">
        <li>
          <a href="../../../index.html"><img style="height: 25px;" src="../../../images/logo-top.svg"></a>
        </li>
        <li>
        <span data-responsive-toggle="responsive-menu" data-hide-for="medium">
          <button class="menu-icon" type="button" data-toggle></button>
        </span>
        </li>
      </ul>
    </div>

    <div id="responsive-menu">
      <div class="top-bar-right">
        <ul class="dropdown menu     vertical medium-horizontal" data-dropdown-menu>
          <li><a href="../../../blog/2017-12-trailblazer-2-1-what-you-need-to-know.html">TRB 2.1 IS COMING!</a></li>
          <li><a href="https://trbpro.herokuapp.com/">PREMIUM SUPPORT <img alt="Premium Support" src="../../../images/pro-white.png"></a></li>
          <li><a href="../../../newsletter.html">NEWSLETTER</a></li>
          <li><a href="https://gitter.im/trailblazer/chat" onclick="trackOutboundLink('https://gitter.im/trailblazer/chat'); return false;">CHAT</a></li>
          <li><a href="../../../guides.html">LEARN</a></li>
          <li>
            <a href="01-operation-basics.html#">GEMS</a>
            <ul class="menu vertical">
              <li class=""><a href="../../../gems/cells.html">CELLS</a></li>
              <li class=""><a href="../../../gems/operation/2.0/index.html">OPERATION</a></li>
              <li class=""><a href="../../../gems/reform.html">REFORM</a></li>
              <li class=""><a href="../../../gems/representable.html">REPRESENTABLE</a></li>
              <li class=""><a href="../../../gems/roar.html">ROAR</a></li>
              <li class=""><a href="../../../gems/formular.html">FORMULAR</a></li>
              <li class=""><a href="../../../gems/disposable.html">DISPOSABLE</a></li>
            </ul>
          </li>
          <li>
            <a href="https://leanpub.com/trailblazer" class="button secondary" onclick="trackOutboundLink('https://leanpub.com/trailblazer'); return false;">GET THE BOOK</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>


    <!-- Hero -->
<div class="hero gems-hero operation2-hero">
  <div class="hero-unit">
    <div class="expanded row">
      <div class="columns">
        <h1 id="project_title">
          Operation
        </h1>
      </div>
    </div>
  </div>
</div>


    <div class="expanded row">
      <div class="medium-9 large-10 medium-push-3 large-push-2 columns">
        <article class="operation2-body">

          
            <header id="doc-header">
  <h1 class="doc-page-title">01- Operation Basics</h1>
  <span class="doc-last-updated"><i class="fa fa-clock-o" aria-hidden="true"></i> Last updated 06 June 2017</span>

  
    <span class="doc-last-updated">
      <i class="fa fa-diamond" aria-hidden="true"></i>
      <a href="https://github.com/trailblazer/trailblazer-operation">operation</a>

      <a href="http://trailblazer.to/guides/trailblazer/2.0/01-operation-basics.html">
      <span class="version">v2.0</span>
      </a>

    

    </span>
  

  <hr>

</header>

          

          <div class="row"> <!-- nach doc header -->
            <div class="large-9 columns" id="docs">   <!-- actual docs -->
              <section class=" ">
  <div class="row">
    <div class="column medium-6 ">
        <pre><code>module BlogPost
  class Create &lt; Trailblazer::Operation
    success :hello_world!
    step    :how_are_you?
    success :enjoy_your_day!
    failure :tell_joke!
    # ...
  end
end
</code></pre>


      </div>
    <div class="column medium-6 ">
        <p>The <em>Operation</em> is the central concept of the Trailblazer architecture. It’s a simple service object that encapsulates and orchestrates all the business logic necessary to accomplish a certain task, such as creating a blog post, or updating a user.</p>

<p>In this guide we’ll create a small example operation that’s responsible for having a simple conversation and fixing the other person’s mood.</p>

      </div>
</div></section>

<p>Operation provides you with an API that lets you structure your business code into <em>steps</em>. Its API is heavily inspired by the “Railway-oriented programming” pattern that combines structuring linear code, and error handling - but more on that later.</p>

<p>Don’t let yourself be tricked into thinking the operation is a “god object”, as it’s been called by critics. The opposite is the case: while the operation knows <em>what</em> to orchestrate and <em>when</em>, it has zero knowledge about <em>how</em>, since the implementation of its steps is hidden from it.</p>

<div class="callout">
  
<p>You can find the code for this page <a href="https://github.com/trailblazer/guides/tree/operation-01">here</a>.</p>

</div>

<h2 id="gemfile" data-magellan-target="gemfile">Gemfile</h2>

<p>In the <a href="https://github.com/trailblazer/guides/tree/operation-01">repository</a> for this page, you will find a very slim <code class="highlighter-rouge">Gemfile</code>.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>gem "trailblazer-operation"
gem "rspec"
</code></pre>
</div>

<p>The <code class="highlighter-rouge">trailblazer-operation</code> gem gives you the <code class="highlighter-rouge">Trailblazer::Operation</code> class and its Railway semantics. Nothing more. It does <em>not</em> have any other dependencies, which is helpful as it means you can start learning Trailblazer with a setup as simple as possible.</p>

<p>We will explore the operation’s behavior using specs. This is my personal favorite way to play with new ideas or gems. The examples here will use RSpec, but you can use Minitest if you prefer. Trailblazer is not coupled to any specific test framework.</p>

<h2 id="our-first-operation" data-magellan-target="our-first-operation">Our first Operation</h2>

<p>When implementing a blog website, it’s probably quite handy to give a user the ability to write and create a blog post.</p>

<p>In most web frameworks like Rails, you’d start with a <code class="highlighter-rouge">PostsController</code> and an action <code class="highlighter-rouge">#create</code> that receives and processes a post form.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>class PostsController &lt; RubyOnTrails::Controller
  def create
    post = Post.new
    post.assign_attributes(params[:post])
    if post.save
      notify_current_user!
    else
      render
    end
  end
end
</code></pre>
</div>

<p>Notice how the #create method encapsulates all the business logic involved in creating a post. In Trailblazer we follow the same philosophy of keeping our business logic in one place, but instead of placing it directly into the controller layer (where it’s now tightly coupled to things like HTTP, routing, and rendering a response), we encapsulate everything within a separate class called an operation. The operation focuses solely on domain logic and leaves routing and rendering up to the controller, which also means that Trailblazer operations can be used with any Ruby framework, not just Rails. Another nice thing about this approach is that it means we can start coding our operations right away without any web framework or routing, and even without thinking about HTTP - a deeply relaxing thought.</p>

<p>An operation is simply a Ruby object that inherits from <code class="highlighter-rouge">Trailblazer::Operation</code> and that can be run anywhere.</p>

<p>In <code class="highlighter-rouge">app/blog_post/operation/create.rb</code> I add an empty class:</p>

<pre><code>require "trailblazer/operation"

module BlogPost
  class Create &lt; Trailblazer::Operation
  end
end
</code></pre>

<p><code class="highlighter-rouge">Create</code> is a subclass of <code class="highlighter-rouge">Trailblazer::Operation</code>, but it’s worth noting that we’re only actually inheriting <a href="https://github.com/trailblazer/trailblazer-operation/blob/master/lib/trailblazer/operation.rb">a few dozen lines</a> of code here.</p>

<h2 id="naming" data-magellan-target="naming">Naming</h2>

<p>The actual <code class="highlighter-rouge">Create</code> operation is put into the <code class="highlighter-rouge">BlogPost</code> namespace. This is very common in Trailblazer: we leverage Ruby namespaces. This results in the beautiful operation class named <code class="highlighter-rouge">BlogPost::Create</code>; a very expressive class name, don’t you think?</p>

<p>Before adding any logic, let’s run this very operation via a spec in <code class="highlighter-rouge">spec/blog_post/operation/create_spec.rb</code>.</p>

<pre><code>require "spec_helper"
require_relative "../../../app/blog_post/operation/create"

RSpec.describe BlogPost::Create do
  it do
    BlogPost::Create.()
  end
end
</code></pre>

<p>In an empty test case, we invoke (or <em>call</em>) our as-yet unspoiled operation.</p>

<h2 id="call" data-magellan-target="call">Call</h2>

<p>That’s right, there’s only one way to run an operation, and that’s the “<code class="highlighter-rouge">call</code> style”. Confused? Here’s an alternative way to spell <code class="highlighter-rouge">BlogPost::Create.()</code>:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>BlogPost::Create.call()
</code></pre>
</div>

<p><code class="highlighter-rouge">.()</code> is just an alias for <code class="highlighter-rouge">.call()</code>. This is pure Ruby, nothing to do with Trailblazer, and was introduced in Ruby 1.9 if I remember correctly. While it might look bizarre to you at first glance, there’s a profound reasoning behind this decision.</p>

<!-- instantiation? -->
<p>An operation, conceptually, is just a <em>function</em>. It does only one thing and doesn’t need more than one public method. Since the operation’s name reflect what it does, you don’t need a method name. This is why in Trailblazer you will have many <code class="highlighter-rouge">call</code>able objects instead of one object with many methods.</p>

<div class="callout">
  
<p>You will soon learn how this greatly improves your architecture since the functional approach minimizes internal state and the <a href="https://apotonick.wordpress.com/2014/05/22/rails-misapprehensions-single-responsibility-principle/">associated mess it might create</a>.</p>

</div>

<p>While our spec works, or at least no exception is raised, this is not very impressive. Let’s see what it actually returns.</p>

<pre><code>it do
  result = BlogPost::Create.()
  puts result #=&gt; #&lt;Trailblazer::Operation::Result:0x9cd7dc4&gt;
end
</code></pre>

<p>Calling an operation always gives you a <em>result object</em>. This object is used to transport state, communicate internals to the outer world, and to indicate whether or not the operation was successful. Why don’t we make sure it didn’t break?</p>

<pre><code>it do
  result = BlogPost::Create.()
  expect( result.success? ).to be_truthy
end
</code></pre>

<p>The <code class="highlighter-rouge">Result#success?</code> method and its inverse <code class="highlighter-rouge">failure?</code> are here to test that, from the caller perspective.</p>

<h2 id="baby-steps" data-magellan-target="baby-steps">Baby Steps</h2>

<p>It might be a good idea to actually add some logic to our operation. While we could simply add a big method with lots of code in a nested procedural style, Trailblazer encourages you to structure your code into a <em>pipeline</em>, where steps in the pipe implement parts of the domain code.</p>

<pre><code>module BlogPost
  class Create &lt; Trailblazer::Operation
    step :hello_world!

    def hello_world!(options, *)
      puts "Hello, Trailblazer!"
    end
  end
end
</code></pre>

<p>You can add steps with the <a href="../../../gems/operation/2.0/api.html#flow-control-step"><code class="highlighter-rouge">step</code> method</a>. It allows you to implement steps using methods, <a href="../../../gems/operation/2.0/api.html#step-implementation-lambda">lambdas</a> and <a href="../../../gems/operation/2.0/api.html#step-implementation-callable">callable objects</a>. For simplicity, let’s start with instance methods. The <code class="highlighter-rouge">hello_world!</code> method sits in the operation as an instance method. It receives some arguments that we’ll learn about later. In the body, it’s up to us to implement that step.</p>

<div class="callout">
  
<p>Suffixing step methods with a bang (e.g. <code>model!</code>) is a purely stylistic choice; it has no semantic meaning.</p>

</div>

<p>Running this operation will hopefully output something.</p>

<pre><code>it do
  result = BlogPost::Create.()
  #=&gt; Hello, Trailblazer!
  expect(result.success?).to be_truthy #=&gt; expected true, got false
end
</code></pre>

<p>We can see a greeting on our command line. But, hang on, what’s that? The operation didn’t finish successfuly, our test just broke… after working with TRB for 2 minutes!</p>

<h2 id="step-return-value-matters" data-magellan-target="step-return-value-matters">Step: Return Value Matters</h2>

<p>The operation fails because the return value of a <code class="highlighter-rouge">step</code> matters! If a step returns <code class="highlighter-rouge">nil</code> or <code class="highlighter-rouge">false</code> (aka. if it returns a <em>falsey</em> value - these are the only two falsey values in Ruby), the operation’s result will be marked as failed, and any steps after the failing step won’t be executed.</p>

<p>Since <code class="highlighter-rouge">puts</code> will always return <code class="highlighter-rouge">nil</code> (and <a href="http://stackoverflow.com/questions/14741329/why-are-all-my-puts-returning-nil">no one knows why</a>), we manually have to return a truthy value to make the next step be invoked.</p>

<pre><code>module BlogPost
  class Create &lt; Trailblazer::Operation
    step :hello_world!

    def hello_world!(options, *)
      puts "Hello, Trailblazer!"
      true
    end
  end
end
</code></pre>

<p>It looks odd, and we should’ve simply used <code class="highlighter-rouge">p</code> (which prints the string <em>and</em> returns a truthy value), but it will probably make the spec pass.</p>

<pre><code>it do
  result = BlogPost::Create.()
  #=&gt; Hello, Trailblazer!
  expect(result.success?).to be_truthy
end
</code></pre>

<p>Yes, our tests are green again.</p>

<h2 id="multiple-steps" data-magellan-target="multiple-steps">Multiple Steps</h2>

<p>Having fixed the first problem, we should extend our operation with another step.</p>

<p>Multiple steps will be executed in the order you added them.</p>

<pre><code>module BlogPost
  class Create &lt; Trailblazer::Operation
    step :hello_world!
    step :how_are_you?

    def hello_world!(options, *)
      puts "Hello, Trailblazer!"
      true
    end

    def how_are_you?(options, *)
      puts "How are you?"
      true
    end
  end
end
</code></pre>

<p>The operation will now greet and enquire about your wellbeing.</p>

<pre><code>it do
  result = BlogPost::Create.()
  #=&gt; Hello, Trailblazer!
  #=&gt; How are you?
  expect(result.success?).to be_truthy
end
</code></pre>

<p>How friendly! I wish more operations could be like you.</p>

<h2 id="breaking-things" data-magellan-target="breaking-things">Breaking Things</h2>

<p>We’re all curious about what will happen when the first step returns <code class="highlighter-rouge">false</code> instead of <code class="highlighter-rouge">true</code>, aren’t we?</p>

<pre><code>module BlogPost
  class Create &lt; Trailblazer::Operation
    step :hello_world!
    step :how_are_you?

    def hello_world!(options, *)
      puts "Hello, Trailblazer!"
      # true
    end

    def how_are_you?(options, *)
      puts "How are you?"
      true
    end
  end
end
</code></pre>

<p>The <code class="highlighter-rouge">hello_world!</code> step now returns <code class="highlighter-rouge">nil</code>, making the operation’s flow “fail”. What does that mean?</p>

<pre><code>result = BlogPost::Create.()
#=&gt; Hello, Trailblazer!
expect(result.failure?).to be_truthy
</code></pre>

<p>The step following the “broken” step now doesn’t get executed anymore. Furthermore, the operation’s result is a failure. Awesome, we broke things, and that’s exactly what we wanted!</p>

<h2 id="basic-flow-control" data-magellan-target="basic-flow-control">Basic Flow Control</h2>

<section class=" ">
  <div class="row">
    <div class="column medium-4 ">
        <p><img src="../../../images/diagrams/guide-op-railway1.gif" width="140"></p>


      </div>
    <div class="column medium-8 ">
        <p>Apparently, <code>step</code> allows us to define some kind of flow. If one <code>step</code> returns a falsey value, all other remaining steps are skipped.</p>

<p>We will soon see that this is great for error handling, as it takes away nested <code>if</code>s and <code>else</code>s in your code and formalizes them in a declarative pipe.</p>

<p>Check out the diagram on the left hand. This is how Trailblazer structures the flow, but more on that <a href="01-operation-basics.html#error-handling">later</a>.</p>

      </div>
</div></section>

<h2 id="success" data-magellan-target="success">Success!</h2>

<p>We don’t really test anything in the first two steps, and returning <code class="highlighter-rouge">true</code> looks weird. Luckily, Trailblazer gives us the <code class="highlighter-rouge">success</code> method to define a step that always passes. Or, in other words: the return value is ignored and assumed it was <code class="highlighter-rouge">true</code>.</p>

<pre><code>module BlogPost
  class Create &lt; Trailblazer::Operation
    success :hello_world!
    success :how_are_you?

    def hello_world!(options, *)
      puts "Hello, Trailblazer!"
    end

    def how_are_you?(options, *)
      puts "How are you?"
    end
  end
end
</code></pre>

<p>This looks better, and, more important: another developer looking at this operation will instantly understand the first two steps do always pass.</p>

<p>We now understand how to implement an operation with successive steps, and how to communicate that to the caller with the result object. Next, we should explore how to <em>read</em> input, test it and maybe have alternative flows depending on a certain value.</p>

<h2 id="handling-input" data-magellan-target="handling-input">Handling Input</h2>

<p>Since our operation seems to be interested in our health, and actually asks us about it, we should pass the answer into it. With operations, there’s only one way to pass data into it, and that’s, of course, in <code class="highlighter-rouge">call</code>.</p>

<pre><code>it do
  result = BlogPost::Create.( { happy: "yes" } )
  #=&gt; Hello, Trailblazer!
  #=&gt; How are you?
  #=&gt; Good to hear, have a nice day!
  expect(result.success?).to be_truthy
end
</code></pre>

<p>We now have to implement a check that tests our answer, and if it happens to be <code class="highlighter-rouge">"yes"</code>, wish a good day, and make the outcome successful.</p>

<pre><code>module BlogPost
  class Create &lt; Trailblazer::Operation
    success :hello_world!
    step    :how_are_you?
    success :enjoy_your_day!

    def hello_world!(options, *)
      puts "Hello, Trailblazer!"
    end

    def how_are_you?(options, params:, **)
      puts "How are you?"

      params[:happy] == "yes"
    end

    def enjoy_your_day!(options, *)
      puts "Good to hear, have a nice day!"
    end
  end
end
</code></pre>

<p>The middle step <code class="highlighter-rouge">how_are_you?</code> is now added with <code class="highlighter-rouge">step</code>, making its return value matter. That means, if the <code class="highlighter-rouge">params[:happy] == "yes"</code> check is true, the next step is going to be executed. And, surprisingly, given the above test case with the respective input, this works.</p>

<p>Of course, we now have to test the opposite scenario, too. What if we’re unhappy?</p>

<pre><code>it do
  result = BlogPost::Create.( { happy: "i'm sad!" } )
  #=&gt; Hello, Trailblazer!
  #=&gt; How are you?
  expect(result.failure?).to be_truthy
end
</code></pre>

<p>Then, only the first two steps are executed, the third is skipped. Also, the result’s state is “failed”.</p>

<h2 id="options" data-magellan-target="options">Options</h2>

<p>Before we dive into error handling, let’s quickly discuss how steps access the input.</p>

<p>Remember how we called the operation?</p>

<pre><code>result = BlogPost::Create.( { happy: "yes" } )
</code></pre>

<p>The first argument passed to <code class="highlighter-rouge">call</code> will be available via <code class="highlighter-rouge">options["params"]</code> in every step.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>def how_are_you?(options, *)
  # ...
  options["params"] #=&gt; { happy: "yes" }
end
</code></pre>
</div>

<p>It’s a bit tedious to always go through <code class="highlighter-rouge">options</code>, so Trailblazer harnesses <em>keyword arguments</em> a lot to simplify accessing data. Keyword arguments are an incredibly cool feature introduced in Ruby 2.0.</p>

<p>So, instead of going through <code class="highlighter-rouge">options</code>, you can tell Ruby to extract the params into the local <code class="highlighter-rouge">params</code> variable.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>def how_are_you?(options, params:, **)
  # ...
  params #=&gt; { happy: "yes" }
end
</code></pre>
</div>

<p>This is highly recommended as it simplifies the method body, and as a nice side effect, Ruby will complain if params are not available. You may also set a default value for the keyword argument, but let’s talk about this another time.</p>

<p>Note the double-splat <code class="highlighter-rouge">**</code> at the end of the argument list. It means “I know there are more keyword arguments coming in, but I’m not interested right now”. It ignores other kw args that <a href="../../../gems/operation/2.0/api.html#step-arguments">Trailblazer passes into the step</a>.</p>

<h2 id="error-handling" data-magellan-target="error-handling">Error Handling</h2>

<p>The operation’s pipe doesn’t only allow you to skip steps, but also to handle errors. And this is where it makes sense to introduce the mental model for Trailblazer, the <a href="http://fsharpforfunandprofit.com/rop/"><em>Railway</em> paradigm from functional programming</a>.</p>

<section class=" ">
  <div class="row">
    <div class="column medium-4 ">
        <p><img src="../../../images/diagrams/guide-op-railway1.gif"></p>


      </div>
    <div class="column medium-8 ">
        <p>Steps added with <code>success</code> will go on the <em>right track</em>. Once that step is executed, a following step will be invoked regardless of the preceding result. This is why <code>hello_world!</code> and then <code>how_are_you?</code> are always called, in that very order.</p>

<p>When adding with <code>step</code>, it will also go on the right track. However, now the step’s result is crucial. This is where you create a switch that might deviate to the <em>left track</em>.</p>

<p>Handling an eventual error in <code>how_are_you?</code> now becomes nothing more than adding a step on the left track, after the erroring one. This works with <code>failure</code>.</p>

<p>And keep in mind, there can be any number of steps on each track. You can even jump back and fourth.</p>

      </div>
</div></section>

<div class="callout">
  
<p>We also call the pipe a <em>railway</em> because it has different tracks and mentally follows a train/track scenario.</p>

</div>

<h2 id="failure" data-magellan-target="failure">Failure</h2>

<p>In order to handle the case that <code class="highlighter-rouge">how_are_you?</code> returns a negative mood, we need to add an error handler on the left track. As already discussed, this happens via <code class="highlighter-rouge">failure</code>.</p>

<pre><code>module BlogPost
  class Create &lt; Trailblazer::Operation
    success :hello_world!
    step    :how_are_you?
    success :enjoy_your_day!
    failure :tell_joke!
    def hello_world!(options, *)
      puts "Hello, Trailblazer!"
    end

    def how_are_you?(options, params:, **)
      puts "How are you?"

      params[:happy] == "yes"
    end

    def enjoy_your_day!(options, *)
      puts "Good to hear, have a nice day!"
    end

    def tell_joke!(options, *)
      options["joke"] = "Broken pencils are pointless."
    end
  end
end
</code></pre>

<p>The pipe, or railway, created now represents the one we’ve just seen in the diagram. Due to the way <code class="highlighter-rouge">failure</code> works, it will only be executed if <code class="highlighter-rouge">how_are_you?</code> fails.</p>

<h2 id="writing-output" data-magellan-target="writing-output">Writing Output</h2>

<p>In the new <code class="highlighter-rouge">tell_joke!</code> step, you can see that we write to <code class="highlighter-rouge">options</code>. That’s how you communicate state changes to the outer world. For example, that could be an error message interpreted by the operation user.</p>

<p>Note that writing applies to any kind of state, right or left track! To keep this example brief, we only write in this one step, though.</p>

<pre><code>it do
  result = BlogPost::Create.( { happy: false } )
  #=&gt; Hello, Trailblazer!
  #=&gt; How are you?
  expect(result.failure?).to be_truthy
  expect(result["joke"]).to eq "Broken pencils are pointless."
end
</code></pre>

<p>When passing in a negative (or false) value for <code class="highlighter-rouge">:happy</code>, the second step <code class="highlighter-rouge">how_are_you?</code> will deviate to the left track. This is why we can test the result’s state for <code class="highlighter-rouge">failure?</code> and why the <code class="highlighter-rouge">options[:joke]</code> value is set.</p>

<p>It’s up to the operation caller to decide whether or not they find this joke hilarious.</p>

<h2 id="interpretation" data-magellan-target="interpretation">Interpretation</h2>

<p>Speaking about decisions: in Trailblazer, it is not the operation’s job or scope to decide what will happen given that the railway took path A, B or even C. The operation may write as many flags, objects, booleans, whatever you need to the <code class="highlighter-rouge">options</code> hash and thus expose state and internal decisions.</p>

<p>Nevertheless, the interpretation of the result is the sole business of the caller. <em>What</em> will happen with this result is up to the controller, the background job, or wherever else you use the operation.</p>

<p>To make sure that the operation provides those values and to have a contract with the outer world, you write tests with assumptions. In case someone changes those assumptions, the test will fail.</p>

<p>Given these boundaries, it’s quite obvious now why the operation does not have access to the environment, and why HTTP is not it’s business at all. We will learn how this is handled in a further chapter.</p>

<p>Having understood the basic mechanics of the operation, in <a href="http://trailblazer.to/guides/trailblazer/2.0/02-trailblazer-basics.html">the next chapter</a> we are going to discover what additional abstractions Trailblazer brings, and how policies, forms, persistence layer and all that hooks into the operation’s workflow.</p>

<section class=" ">
  <div class="row">
    <div class="column medium-12 text-center">
        <p><a href="02-trailblazer-basics.html" class="button">GO TO PART 2: TRAILBLAZER BASICS!</a></p>

      </div>
</div></section>

            </div>

            <div class="large-3 columns sticky-container" data-sticky-container>

              
                <nav class="sticky columns docs-toc-wrap sticky is-anchored is-at-top side-nav" data-sticky data-anchor="docs" data-sticky-on="large" data-margin-top="5">
  
        <ul class="vertical menu" data-magellan id="page-toc">
          <li class="page-toc-heading">ON THIS PAGE:</li>
          <li><a href="01-operation-basics.html#gemfile">Gemfile</a></li>
<li><a href="01-operation-basics.html#our-first-operation">Our first Operation</a></li>
<li><a href="01-operation-basics.html#naming">Naming</a></li>
<li><a href="01-operation-basics.html#call">Call</a></li>
<li><a href="01-operation-basics.html#baby-steps">Baby Steps</a></li>
<li><a href="01-operation-basics.html#step-return-value-matters">Step: Return Value Matters</a></li>
<li><a href="01-operation-basics.html#multiple-steps">Multiple Steps</a></li>
<li><a href="01-operation-basics.html#breaking-things">Breaking Things</a></li>
<li><a href="01-operation-basics.html#basic-flow-control">Basic Flow Control</a></li>
<li><a href="01-operation-basics.html#success">Success!</a></li>
<li><a href="01-operation-basics.html#handling-input">Handling Input</a></li>
<li><a href="01-operation-basics.html#options">Options</a></li>
<li><a href="01-operation-basics.html#error-handling">Error Handling</a></li>
<li><a href="01-operation-basics.html#failure">Failure</a></li>
<li><a href="01-operation-basics.html#writing-output">Writing Output</a></li>
<li><a href="01-operation-basics.html#interpretation">Interpretation</a></li>
        </ul>
      
</nav>

              

            </div>
          </div>
        </article>
      </div>

      <div class="medium-3 large-2 medium-pull-9 large-pull-10 columns">
        <ul id="sidebar" class="side-nav accordion" data-accordion>
  <li class="accordion-item" data-accordion-item>
    <a href="01-operation-basics.html#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong>OPERATION</strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <li><a href="../../../gems/operation/2.0/index.html">Overview</a></li>
        <li><a href="../../../gems/operation/2.0/api.html">API</a></li>
        <li><a href="../../../gems/operation/2.0/contract.html">Contract</a></li>
        <!--<li><a href="/gems/operation/2.0/representer.html">Representer</a></li>-->
        <li><a href="../../../gems/operation/2.0/policy.html">Policy</a></li>
        <li><a href="../../../gems/operation/2.0/representer.html">Representer</a></li>
        <!--<li><a href="/gems/operation/2.0/pipetree.html">Pipetree</a></li>-->
        <li><a href="../../../gems/operation/2.0/endpoint.html">Endpoint</a></li>
        <li>
<a href="../../../gems/operation/1.1/index.html">
            <span class="sidebar-info">→ v1.1</span>
          </a>
        </li>
      </ul>
    </div>
  </li>

  <li class="accordion-item" data-accordion-item>
    <a href="01-operation-basics.html#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong>TRAILBLAZER</strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <li><a href="../../../gems/trailblazer/index.html">Overview</a></li>
        <li><a href="../../../gems/trailblazer/2.0/rails.html">Rails</a></li>
        <li><a href="../../../gems/trailblazer/2.0/test.html">Test</a></li>
        <li><a href="../../../gems/trailblazer/loader.html">Loader</a></li>
        <li><a href="../../../gems/trailblazer/upgrading-1-to-2.html">Upgrading</a></li>
      </ul>
    </div>
  </li>

  <li class="accordion-item" data-accordion-item>
    <a href="01-operation-basics.html#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong>CELLS</strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <li><a href="../../../gems/cells.html">Overview</a></li>
        <li><a href="../../../gems/cells/getting-started.html">Getting Started<span class="sidebar-info">NEW</span></a></li>
        <li><a href="../../../gems/cells/api.html">API</a></li>
        <li><a href="../../../gems/cells/trailblazer.html">Trailblazer::Cell</a></li>
        <li><a href="../../../gems/cells/testing.html">Testing</a></li>
        <li><a href="../../../gems/cells/render.html">Rendering</a></li>
        <li><a href="../../../gems/cells/rails.html">Rails</a></li>
        <li><a href="../../../gems/cells/templates.html">Templates</a></li>
        <li><a href="../../../gems/cells/troubleshooting.html">Troubleshooting</a></li>
      </ul>
    </div>
  </li>

  <li class="accordion-item" data-accordion-item>
    <a href="01-operation-basics.html#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong>REFORM</strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <li><a href="../../../gems/reform/index.html">Overview</a></li>
        <li><a href="../../../gems/reform/api.html">API</a></li>
        <li><a href="../../../gems/reform/options.html">Options</a></li>
        <li><a href="../../../gems/reform/data-types.html">Data Types</a></li>
        <li><a href="../../../gems/reform/populator.html">Populator</a></li>
        <li><a href="../../../gems/reform/prepopulator.html">Prepopulator</a></li>
        <li><a href="../../../gems/reform/validation.html">Validation</a></li>
        <li><a href="../../../gems/reform/rails.html">Rails</a></li>
        <li><a href="../../../gems/reform/debugging.html">Debugging</a></li>
        <li><a href="../../../gems/reform/upgrading-guide.html">Upgrading Guide</a></li>
      </ul>
    </div>
  </li>

  <li class="accordion-item" data-accordion-item>
    <a href="01-operation-basics.html#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong>REPRESENTABLE</strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <li><a href="../../../gems/representable.html">Overview</a></li>
        <li><a href="../../../gems/representable/getting-started.html">Getting Started</a></li>
        <li><a href="../../../gems/representable/3.0/api.html">API</a></li>
        <li><a href="../../../gems/representable/3.0/function-api.html">Function API</a></li>
        <li><a href="../../../gems/representable/3.0/populator.html">Populator</a></li>
        <!--<li><a href="/gems/representable/architecture.html">Architecture</a></li>-->
        <li><a href="../../../gems/representable/3.0/xml.html">XML</a></li>
        <li><a href="../../../gems/representable/3.0/yaml.html">YAML</a></li>
        <li><a href="../../../gems/representable/upgrading-guide.html">Upgrading Guide</a></li>
      </ul>
    </div>
  </li>

  <li class="accordion-item" data-accordion-item>
    <a href="01-operation-basics.html#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong>ROAR</strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <li><a href="../../../gems/roar/index.html">Overview</a></li>
        <li><a href="../../../gems/roar/jsonapi.html">JSON API</a></li>
      </ul>
    </div>
  </li>

  <li class="accordion-item" data-accordion-item>
    <a href="01-operation-basics.html#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong>FORMULAR</strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <!-- <li><a href="/gems/formular/index.html">Overview</a></li> -->
        <li><a href="../../../gems/formular/bootstrap.html">Bootstrap</a></li>
      </ul>
    </div>
  </li>

  <li class="accordion-item" data-accordion-item>
    <a href="01-operation-basics.html#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong>DISPOSABLE</strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <li><a href="../../../gems/disposable/index.html">Overview</a></li>
        <li><a href="../../../gems/disposable/api.html">API</a></li>
        <li><a href="../../../gems/disposable/default.html">Default</a></li>
        <li><a href="../../../gems/disposable/callback.html">Callback</a></li>
      </ul>
    </div>
  </li>

  <li class="accordion-item" data-accordion-item>
    <a href="01-operation-basics.html#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong>GUIDES</strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <li><a href="../../index.html">Overview</a></li>
        <li><a href="http://trailblazer.to/guides/trailblazer/2.0/01-operation-basics.html" class="active">01 - Operation Basics</a></li>
        <li><a href="http://trailblazer.to/guides/trailblazer/2.0/02-trailblazer-basics.html">02 - Trailblazer Basics</a></li>
        <li><a href="03-rails-basics.html">03 - Rails Basics</a></li>
      </ul>
    </div>
  </li>

  <!--
  <li class="accordion-item" data-accordion-item>
    <a href="#" class="accordion-title">
      <i class="fa fa-caret-square-o-right" aria-hidden="true"></i>
      <strong></strong>
    </a>
    <div class="accordion-content" data-tab-content>
      <ul class="vertical menu">
        <li><a href="">Overview</a></li>
        
      </ul>
    </div>
  </li>

  -->
</ul>

<script>
  (function (document, window) {
    var $sidebar = $('#sidebar');
    var $items = $sidebar.find('.accordion-item')
    var currentPath = window.location.pathname;

    $items.each(function (i, elem) {
      var $elem = $(elem);
      var linkHref = $elem
        .find('.accordion-content li:first-child a')
        .attr('href')
        .replace('index.html', '');

      if (currentPath.indexOf(linkHref) !== -1) {
        $elem.addClass('is-active')
      }
    })
  })(document, window);
</script>

      </div>
    </div>


    <section class="top-footer">
  <div class="row">
    <div class="columns medium-6">
      <h3>Newsletter</h3>
      <p>
        Stay on top of what’s happening in Trailblazer.
      </p>
        <div class="row">
          <div id="mc_embed_signup">
            <form action="http://trailblazerb.us8.list-manage.com/subscribe/post?u=bbe5021ab6fbdc94a16f0d036&amp;id=a69f6e4652" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

              <div class="columns large-9 medium-12 ">
                <div class="row collapse prefix-radius">
                  <div class="small-8 medium-7 large-8 columns">
                    <div id="mc_embed_signup_scroll">
                      <div class="mc-field-group">
                        <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="youremail@trailblazer.to">
                      </div>
                      <div id="mce-responses" class="clear">
                        <div class="response" id="mce-error-response" style="display:none"></div>
                        <div class="response" id="mce-success-response" style="display:none"></div>
                      </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_bbe5021ab6fbdc94a16f0d036_a69f6e4652" tabindex="-1" value=""></div>

                    </div>
                  </div>
                  <div class="small-4 medium-5 large-4 columns">
                    <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button postfix secondary">
                  </div>
                </div>
              </div>
            </form>
          </div>
          <script type="text/javascript" src="http://s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
        </div>
      <p>
        And check out the <a href="../../../newsletter.html">archive of newsletters</a>!
      </p>


    </div>
    <div class="columns medium-6">
      <h3>The Book</h3>
      <p>Learn how to build a Rails app with Trailblazer, step-by-step.</p>
      <a href="https://leanpub.com/trailblazer" class="button secondary">Get the book!</a>
    </div>
  </div>
</section>

<footer>
  <div class="row">
    <div class="columns medium-4">
      <div class="logo-box">
        <a href="../../../index.html"><img src="../../../images/icon_trb.png">
        </a>
      </div>
    </div>
    <div class="columns medium-8">
      <div class="row">
        <div class="columns medium-6">
          <h4>
            Trailblazer
          </h4>
          <ul class="no-bullet">
            <li><a href="https://gitter.im/trailblazer/chat">Gitter chat</a></li>
            <li><a href="https://leanpub.com/trailblazer" onclick="trackOutboundLink('https://leanpub.com/trailblazer'); return false;">The book</a></li>
          </ul>
        </div>
        <div class="columns medium-6">
          <h4>
            Follow Us
          </h4>
          <ul class="menu">
            <li>
              <a href="https://github.com/trailblazer">
                <i class="footer-icon github-icon"></i>
              </a>
            </li>
            <li>
              <a href="https://twitter.com/trailblazer_to">
                <i class="footer-icon twitter-icon"></i>
              </a>
            </li>
            <li>
              <a href="https://facebook.com/trailblazer.to">
                <i class="footer-icon facebook-icon"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <p class="copyright">
        Trailblazer is created by <a href="../../../inc/index.html">Trailblazer GmbH</a> and awesome friends.
      </p>
      <p class="copyright">
        Site designed and handcoded with love by <a href="https://twitter.com/noeliacabane">Noelia Cabane</a>
      </p>
    </div>
  </div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69514939-1', 'auto');
  ga('send', 'pageview');

  /**
  * Function that tracks a click on an outbound link in Analytics.
  * This function takes a valid URL string as an argument, and uses that URL string
  * as the event label. Setting the transport method to 'beacon' lets the hit be sent
  * using 'navigator.sendBeacon' in browser that support it.
  */
  var trackOutboundLink = function(url) {
     ga('send', 'event', 'outbound', 'click', url, {
       'transport': 'beacon',
       'hitCallback': function(){document.location = url;}
     });
  }
</script>



  </body>
</html>
