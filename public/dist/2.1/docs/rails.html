<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

    <title>Trailblazer - Rails</title>

    
    <script src="/vite/assets/documentation.090e3fb2.js" crossorigin="anonymous" type="module"></script><link rel="modulepreload" href="/vite/assets/main.8edf4e21.js" as="script" crossorigin="anonymous">
<link rel="modulepreload" href="/vite/assets/initAnchor.90976c72.js" as="script" crossorigin="anonymous"><link rel="stylesheet" href="/vite/assets/main.f0b29665.css" media="screen" />
<link rel="stylesheet" href="/vite/assets/initAnchor.22f475c1.css" media="screen" />

    <link
      href="https://fonts.googleapis.com/css?family=Raleway:200,300,400,500,600,700,800"
      rel="stylesheet"
    >
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    >
    

    
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script
        async
        src="https://www.googletagmanager.com/gtag/js?id=UA-69514939-1"
      ></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        gtag("js", new Date());

        gtag("config", "UA-69514939-1");
      </script>
    

    <link rel="icon" type="image/png" sizes="32x32" href="/vite/assets/favicon.39e9303e.ico">
  </head>
  <body>
    <div class="alert alert-primary m-0 rounded-0 text-center" role="alert">
      <span class="alert-text text-center">
        <!-- The new TRB 2.1 book series has begun - 82 pages are <a class="alert-link" href="https://leanpub.com/buildalib">waiting for you</a>! -->
        Dear Russian friends, please watch President Zelenskyy's
        <a href="https://twitter.com/PMoelleken/status/1496941845812760577">speech addressed to you</a>.
        🇺🇦 Help our brave mates in Ukraine
        <a
          href="https://actions.sumofus.org/a/give-to-ukrainians-who-need-an-urgent-lifeline"
        >
          with a donation
        </a>.
      </span>
    </div>

    <div class="lg-bg">
      <!-- Add class="session-show" if you need a header with dark background -->
      <header
        id="header"
        class="trailblazer-header documentation-navbar navbar navbar-expand-lg flex-column flex-md-row"
      >
        <h1 class="m-2">
          <a class="navbar-brand mr-0 mr-md-2" href="/2.1/index.html">Trailblazer</a>
        </h1>

        <div class="navbar-nav-scroll ml-md-auto">
          <ul class="navbar-nav documentation-nav-items">
  <li>
    <a class="nav-item nav-link active" href="/2.1/docs/trailblazer.html">
      <i class="fas fa-arrow-right"></i>
      DOCS
    </a>
  </li>

  <li>
    <a class="nav-item nav-link " href="https://dev.to/trailblazer">BLOG</a>
  </li>

  <li class="d-none d-md-block">
    <a class="nav-item nav-link " href="/2.1/about_us.html">ABOUT US</a>
  </li>

  <li>
    <a class="nav-item nav-link " href="/2.1/learn.html">LEARN</a>
  </li>

  <li class="d-none d-md-block">
    <a class="nav-item nav-link" href="/2.0/index.html">
      <i class="fas fa-arrow-right"></i>
      2.0
    </a>
  </li>

  <li>
    <a class="nav-item nav-link" href="https://trailblazer.zulipchat.com" target="_blank">
      <i class="fas fa-comments"></i>
      CHAT
    </a>
  </li>

  <!--
  
    <li>
      <div id="docsearch"></div> https://docsearch.algolia.com/docs/DocSearch-v3
    </li>
  
  -->
</ul>

        </div>
      </header>

      <main>
        <section class="documentation-main">
          <div class="container-fluid">
            <div class="row flex-xl-nowrap">
              <div class="col-md-3 doc-xl-2 border-bottom order-1 sidebar-accordion sidebar-scroll">
                <form class="d-md-none d-flex align-items-center position-relative py-3 mx-n3 border-bottom">
                  <button
                    class="navbar-toggler collapsed"
                    type="button"
                    data-toggle="collapse"
                    data-target="#navBarTrailBlazer"
                    aria-controls="navBarTrailBlazer"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                  >
                    <i class="far fa-lg fa-bars"></i>
                  </button>
                </form>
                <div class="collapse d-md-block py-3 mx-n3" id="navBarTrailBlazer">
                  <div class="border-bottom">
  <div class="my-4">
    <div class="sidebar-accordion-wrapper">
  <div id="trailblazer">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/trailblazer.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#trailblazer-collapse"
          aria-expanded="false"
          aria-controls="trailblazer-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Trailblazer</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="rails-integration">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/rails.html">
        <button
          class=""
          data-toggle="collapse"
          data-target="#rails-integration-collapse"
          aria-expanded="true"
          aria-controls="rails-integration-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Rails Integration</span>
        </button>
      </a>
    </h2>
  </div>

  
    <div
      id="rails-integration-collapse"
      class="collapse show"
      aria-labelledby="rails-integration"
      data-parent="#accordion"
    >
      <ul class="nav vertical menu navbar-light">
        
          <li class="nav-item">
            <a class="nav-link active" href="#rails-integration-controller">
              Controller
            </a>
          </li>
        
          <li class="nav-item">
            <a class="nav-link " href="#rails-integration-cells">
              Cells
            </a>
          </li>
        
          <li class="nav-item">
            <a class="nav-link " href="#rails-integration-reform">
              Reform
            </a>
          </li>
        
          <li class="nav-item">
            <a class="nav-link " href="#rails-integration-loader">
              Loader
            </a>
          </li>
        
      </ul>
    </div>
  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="test">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/test.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#test-collapse"
          aria-expanded="false"
          aria-controls="test-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Test</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="internals">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/internals.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#internals-collapse"
          aria-expanded="false"
          aria-controls="internals-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Internals</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

  </div>
</div>

<div class="border-bottom">
  <div class="my-4">
    <div class="sidebar-accordion-wrapper">
  <div id="activity">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/activity.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#activity-collapse"
          aria-expanded="false"
          aria-controls="activity-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Activity</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="macro">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/macro.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#macro-collapse"
          aria-expanded="false"
          aria-controls="macro-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Macro</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="operation">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/operation.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#operation-collapse"
          aria-expanded="false"
          aria-controls="operation-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Operation</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="workflow">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/workflow.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#workflow-collapse"
          aria-expanded="false"
          aria-controls="workflow-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Workflow</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="endpoint">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/endpoint.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#endpoint-collapse"
          aria-expanded="false"
          aria-controls="endpoint-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Endpoint</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

  </div>
</div>

<div class="border-bottom">
  <div class="my-4">
    <div class="sidebar-accordion-wrapper">
  <div id="reform">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/reform.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#reform-collapse"
          aria-expanded="false"
          aria-controls="reform-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Reform</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="cells">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/cells.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#cells-collapse"
          aria-expanded="false"
          aria-controls="cells-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Cells</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="representable">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/representable.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#representable-collapse"
          aria-expanded="false"
          aria-controls="representable-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Representable</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="disposable">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/disposable.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#disposable-collapse"
          aria-expanded="false"
          aria-controls="disposable-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Disposable</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="roar">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/roar.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#roar-collapse"
          aria-expanded="false"
          aria-controls="roar-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Roar</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

  </div>
</div>

<div class="border-bottom">
  <div class="my-4">
    <div class="sidebar-accordion-wrapper">
  <div id="tutorials">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/tutorials/activity.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#tutorials-collapse"
          aria-expanded="false"
          aria-controls="tutorials-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>Tutorials</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

<div class="sidebar-accordion-wrapper">
  <div id="pro">
    <h2 class="mb-0 mt-1 sidebar-accordion-item">
      <a href="/2.1/docs/pro.html">
        <button
          class="collapsed"
          data-toggle="collapse"
          data-target="#pro-collapse"
          aria-expanded="false"
          aria-controls="pro-collapse"
        >
          <i class="fas fa-chevron-right"></i>
          <i class="fas fa-times"></i>
          <span>PRO</span>
        </button>
      </a>
    </h2>
  </div>

  
</div>

  </div>
</div>

                </div>
              </div>

              <main class="col-md-9 doc-xl-8 py-md-5 pl-md-5 order-2" role="main">
                <div class="doc-block section-name session-show">
                  <h1 class="w-100">Rails Integration</h1>
                  <ul>
                    <li>
                      <i class="far fa-clock pink"></i>
                      <span>Last updated 29 Oct 22</span>
                    </li>
                  </ul>
                </div>

                <div class="doc-block">
<p>Trailblazer runs with any Ruby web framework, whether that is Rails, Hanami or Grape. Why? Because it’s a set of additional abstraction layers like forms, service objects (“operations”) or view components. Those are designed to be completely isolated and decoupled from the hosting infrastructure framework.</p>

<p>Nevertheless, you’re lucky if your project is using Rails since we provide convenient glue code in the <code>trailblazer-rails</code> gem.</p>

<pre><code>gem "trailblazer-rails"
</code></pre>

<p>This will automatically pull the <code>trailblazer</code> gem along with its commonly used dependencies. The <code>Trailblazer::Rails::Railtie</code> railtie will activate all necessary convenience methods for you. You don’t have to do anything manually.</p>

<div class="bd-callout bd-callout-info">
<p>There’s a beautiful QUICK START tutorial introducing you to <a href="/2.1/docs/tutorials/activity.html#tutorials-quick-start-03-rails-basics">Trailblazer in Rails</a>.</p>
</div>

<p><span class="divider"></span></p>

<h2 id="rails-integration-controller">Controller</h2>
<p><!-- {rails-integration-controller-toc} --></p>

<p><a href="https://github.com/trailblazer/trailblazer-rails" class="pink"><i class="fa fa-gem" aria-hidden="true"></i> trailblazer-rails</a></p>

<p>Controller extensions help with</p>

<ul>
  <li>invoking operations and dealing with the outcome</li>
  <li>rendering cells that access variables from the operation’s result object</li>
</ul>

<p>Please note, though, that we’re slowly moving towards using <a href="/2.1/docs/endpoint.html">endpoint</a>s in controllers. Once this new layer becomes stable we will support both approaches.</p>

<p><span class="divider"></span></p>

<h3 id="rails-integration-controller-manual-invoke">Manual invoke</h3>
<p><!-- {rails-integration-controller-manual-invoke-toc} --></p>

<p>In order to run an operation in a controller you may simply invoke it manually.</p>

<pre><code>class SongsController &lt; ApplicationController
  def create
    result = Song::Operation::Create.(params: params) # manual invocation.
    # ...
  end
end
</code></pre>

<p>Note how you have to pass all data into the <code>#call</code>, even variables such as <code>params</code>, that are  “magically everywhere” in Rails. This is per design - we want encapsulation!</p>

<p>After running the operation, you need to handle different outcomes.</p>

<pre><code>class SongsController &lt; ApplicationController
  def create
    result = Song::Operation::Create.(params: params) # manual invocation.

    if result.success?
      redirect_to song_path(result[:model].id)
    else # failure
      @form = result[:"contract.default"]

      render
    end
  end
end
</code></pre>

<p>In a bit more complex situations, with more data being passed into the operation, this might become repetitive and quite complex.</p>

<p><a name="trailblazer-rails-run"></a><!-- @old-link -->
<a name="trailblazer-rails-run-return-value"></a><!-- @old-link -->
<!-- http://localhost:4000/2.1/docs/rails.html#rails-support-controller-run-return-value -->
<span class="divider"></span></p>

<h3 id="rails-integration-controller-run">Run</h3>
<p><!-- {rails-integration-controller-run-toc} --></p>

<p>The <code>trailblazer-rails</code> gem provides <code>#run</code> to simplify the task of invoking operations.</p>

<pre><code>def new
  ctx = run Song::Operation::New

  @form = ctx[:"contract.default"]

  render
end
</code></pre>

<p>The <code>#run</code> method will always return the result object (or ctx) from the operation.</p>

<p>While it invokes the specified operation it does three things for you.</p>

<ul>
  <li>Without any additional configuration, <code>#run</code> passes the controller’s <code>params</code> hash into the operation call as in the example above.</li>
  <li>It automatically assigns <code>@model</code> and, if available, <code>@form</code> for you, after invoking the operation.</li>
  <li>The <code>ctx</code> object is assigned to <code>@_result</code>.</li>
</ul>

<p><span class="divider"></span></p>

<ul class="navigation">
    <li>Run</li>
    <li id="rails-integration-controller-run-block-syntax">Block syntax</li>
</ul>

<p>To handle success and failure cases, run accepts an optional block.</p>

<pre><code>def create
  _ctx = run Song::Operation::Create do |ctx|
    # success!
    return redirect_to song_path(ctx[:model].id) # don't forget the return.
  end

  # failure
  @form = _ctx[:"contract.default"]

  render
end
</code></pre>

<p>The block is only run for a successful outcome of the operation - or in other words, when <code>ctx.success?</code> is true. Into the block is passed the result object (or <code>ctx</code>) as a block argument.</p>

<div class="bd-callout bd-callout-info">
<p>Do not forget to use <code>return</code> in the block, otherwise Ruby will execute the remaining code under the block, too.</p>
</div>

<p>After the block, you usually add code for handling a failing outcome of the operation run. Here, you can use the <code>ctx</code> object returned from <code>#run</code>.</p>

<p><span class="divider"></span></p>

<ul class="navigation">
    <li>Run</li>
    <li id="rails-integration-controller-run-keyword-arguments">Keyword arguments</li>
</ul>

<p>The success block of <code>#run</code> can also hand you variables from <code>ctx</code> as keyword arguments, just as you know it from [operation steps].</p>

<pre><code>def create
  _ctx = run Song::Operation::Create do |ctx, model:,**|
    return redirect_to song_path(model.id) # see how model is available?
  end

  # failure
  @form = _ctx[:"contract.default"]

  render
end
</code></pre>

<p>This is convenient shortcut to access ctx variables, and gives you a runtime error should that variable be absent.</p>

<div class="bd-callout bd-callout-info">
<p>Keyword arguments for <code>#run</code> are available from <code>trailblazer-rails</code> &gt;= 2.4.2.</p>
</div>

<p><span class="divider"></span></p>

<ul class="navigation">
    <li>Run</li>
    <li id="rails-integration-controller-run-runtime-variables">Runtime variables</li>
</ul>

<p>If your operation needs more variables in the ctx you can hand in those via <code>#run</code>.</p>

<pre><code>class SongsController &lt; ApplicationController
  # ...
  def create
                                      # vvvvvvvvvvvvvvvvvvvvvvvvvv
    _ctx = run Song::Operation::Create, current_user: current_user do |ctx, model:, **|
      return redirect_to song_path(model.id)
    end

    @form = _ctx[:"contract.default"]

    render
  end
end
</code></pre>

<p>This will add <code>:current_user</code> to the ctx passed into the <code>Song::Operation::Create</code> operation, allowing you to access it in the steps, as done in the example step below.</p>

<pre><code>class Song::Operation::Create &lt; Trailblazer::Operation
  # ...
  step :user_allowed?

  def user_allowed?(ctx, current_user:, **)
    # do something with {current_user}
  end
end
</code></pre>

<p>You can also configure generic <a href="#rails-support-controller-run-run-options">variables on the controller level</a>, they will be passed to all operations of that controller.</p>

<p><span class="divider"></span></p>

<ul class="navigation">
    <li>Run</li>
    <li id="rails-integration-controller-run-run-options">Run Options</li>
</ul>

<p>Often, several operations across an application slice have generic variables, such as the <code>current_user</code>. Instead of redundantly passing them to <code>#run</code> in every controller action, you can configuring variables on the controller-level.</p>

<p>Override <code>#_run_options</code> to do that automatically for all <code>run</code> calls in a controller.</p>

<pre><code>class SongsController &lt; ApplicationController
  private def _run_options(options)
    options.merge(
      current_user: current_user
    )
  end
  # ...
end
</code></pre>

<p>The overridden <code>#_run_options</code> method will result in <code>:current_user</code> being passed into the operation when using <code>#run</code> without having to specify that particular parameter.</p>

<pre><code>def create
  _ctx = run Song::Operation::Create do |ctx, model:, **|
    return redirect_to song_path(model.id)
  end

  @form = _ctx[:"contract.default"]

  render
end
</code></pre>

<p>When mixing both styles, options passed directly to <code>#run</code> will win over possible same-named options in <code>#_run_options</code>.</p>

<p><span class="divider"></span></p>

<h3 id="rails-integration-controller-endpoint">Endpoint</h3>
<p><!-- {rails-integration-controller-endpoint-toc} --></p>

<p><a href="https://github.com/trailblazer/trailblazer-endpoint" class="pink"><i class="fa fa-gem" aria-hidden="true"></i> trailblazer-endpoint</a></p>

<p>During the past few years of Trailblazer a new layer emerged, we call it <em>endpoint</em>. An endpoint is literally an “operation” getting invoked straight from the controller and running your business operation (like <code>Song::Operation::Create</code>) at some point. Before and after that, you can place code steps you’d normally use in <code>before_filter</code> and friends.</p>

<p>We will document this new (completely optional!) layer once it is fully presentable. Until then, check out the <a href="/2.1/docs/endpoint.html">API docs</a>.</p>

<p><span class="divider"></span></p>

<h2 id="rails-integration-cells">Cells</h2>
<p><!-- {rails-integration-cells-toc} --></p>

<p><a href="https://github.com/trailblazer/trailblazer-rails" class="pink"><i class="fa fa-gem" aria-hidden="true"></i> trailblazer-rails</a></p>

<p><a href="/2.1/docs/cells.html">Cells</a> is a separate gem, it provides view components to maintain strong encapsulation in your partial world.</p>

<p>The <code>trailblazer-rails</code> gem makes it very simple to use the Cells gem along with TRB. It overrides <code>ActionController#render</code> and allows to render a cell.</p>

<p><span class="divider"></span></p>

<h3 id="rails-integration-cells-file-structure">File structure</h3>
<p><!-- {rails-integration-cells-file-structure-toc} --></p>

<p>In the early, adventurous days of Cells - the project was kicked off in 2007 - both naming of cell classes and their file structure was following the Rails Way™ style. In a Rails app, you could find a structure as below.</p>

<pre><code>gem "cells"

app
├── cells
│   ├── song_cell.rb
│   ├── song
│   │   ├── show.erb
│   │   ├── list.erb
</code></pre>

<p>While this is still possible by simply using the <code>cells</code> gem stand-alone, most projects using Trailblazer prefer the new file structure implemented in the <code>trailblazer-cells</code> gem.</p>

<pre><code>gem "trailblazer-cells"

app
├── concepts
│   ├── song
│   │   ├── cell
│   │   │   ├── show.rb # Song::Cell::Show
│   │   │   ├── list.rb
│   │   ├── view
│   │   │   ├── show.erb
│   │   │   ├── list.erb
</code></pre>

<p>This results in your cells being named <code>Song::Cell::Show</code>, adhering to the Trailblazer convention. Refer to the <a href="cells.html#cells-trailblazer"><i class="fa fa-book" aria-hidden="true"></i> API docs</a> to learn more about Trailblazer cells.</p>

<p><span class="divider"></span></p>

<h3 id="rails-integration-cells-render">Render</h3>
<p><!-- {rails-integration-cells-render-toc} --></p>

<p>The <code>trailblazer-rails</code> gem extends the <code>#render</code> method and allows you to render cells in controllers and views.</p>

<pre><code>class SongsController &lt; ApplicationController
  def create
    run Song::New # optional

    render cell(Song::Cell::New, @model)
  end
end
</code></pre>

<p>You simply invoke <code>#cell</code> the way you did it before, and pass it to <code>render</code>. If the first argument to <code>#render</code> is not a cell, the original Rails <code>render</code> version will be used, allowing you to use serializers, partials or whatever else you need.</p>

<p><span class="divider"></span></p>

<ul class="navigation">
    <li>Render</li>
    <li id="rails-integration-cells-render-skip-controller-layout">Skip controller layout</li>
</ul>

<p>Per default, <code>#render</code> will add <code>layout: true</code> to render the controller’s ActionView layout.</p>

<p>The controller’s layout can be disabled using <code>layout: false</code>. These are pure Rails mechanics.</p>

<pre><code>render cell(Song::Cell::New, @model), layout: false
</code></pre>

<p>In fact, any option passed to <code>render</code> will be passed through to the controller’s <code>#render</code>.</p>

<p><span class="divider"></span></p>

<ul class="navigation">
    <li>Render</li>
    <li id="rails-integration-cells-render-cell-options">Cell options</li>
</ul>

<p>As you’re using <code>#cell</code> from the Cells gem you may pass any option the cell understands.</p>

<pre><code>render cell(Song::Cell::New, model, layout: Song::Cell::DarkLayout)
</code></pre>

<p>For instance, you can instruct the cell to use a separate layout cell. Note that this option is passed to <code>#cell</code>, not to <code>#render</code>.</p>

<p><span class="divider"></span></p>

<h3 id="rails-integration-cells-configuration">Configuration</h3>
<p><!-- {rails-integration-cells-configuration-toc} --></p>

<p>You can set controller-wide options passed to every <code>#cell</code> call by overriding the <code>#options_for_cell</code> method.</p>

<pre><code>class SongsController &lt; ApplicationController
  private def options_for_cell(model, options)
    {
      layout: Song::Cell::DarkLayout # used for all #cell calls.
    }
  end
end
</code></pre>

<p>This is extremely helpful for providing controller-wide options like <code>:layout</code>, allowing you to skip this specific option in all actions.</p>

<pre><code>class SongsController &lt; ApplicationController
  def create
    # ..
    render cell(Song::Cell::New, model) # no need to pass {layout: Song::Cell::DarkLayout}
  end
</code></pre>

<div class="bd-callout bd-callout-info">
<p>This feature was added in <code>trailblazer-rails</code> version 2.2.0.</p>
</div>

<p><span class="divider"></span></p>

<h2 id="rails-integration-reform">Reform</h2>
<p><!-- {rails-integration-reform-toc} --></p>

<p>Reform is a form object library that helps to move validations out of your models.</p>

<p>It has excellent Rails support which will soon be summarized here. Until then, you can find <a href="/2.1/docs/reform.html#reform-rails">API docs here</a>.</p>

<p><span class="divider"></span></p>

<h2 id="rails-integration-loader">Loader</h2>
<p><!-- {rails-integration-loader-toc} --></p>

<p>The <code>trailblazer-loader</code> gem implements a very simple way to load all files in your <code>concepts</code> directory in a heuristically meaningful order. It can be used in any environment.</p>

<div class="bd-callout bd-callout-info">
<p>In <code>trailblazer-rails</code> 2.3.0 this component has been removed in favor of Rails autoloading. You can safely skip this section!</p>
</div>

<!-- @trailblazer-loader, <trailblazer-loader[] disable loader, file structure -->

<p><span class="divider"></span></p>

<h3 id="rails-integration-loader-loader-with-rails">Loader with Rails</h3>
<p><!-- {rails-integration-loader-loader-with-rails-toc} --></p>

<p>The <code>trailblazer-loader</code> gem comes pre-bundled with <code>trailblazer-rails</code> for historical reasons: in the early days of Trailblazer, the conventional file name <code>concepts/product/operation/create.rb</code> didn’t match the short operation name, such as <code>Product::Create</code>.</p>

<p>The <code>trailblazer-loader</code> gem’s duty was to load all concept files without using Rails’ autoloader, overcoming the latter’s conventions.</p>

<p>Over the years, and with the emerge of controller helpers or our workflow engine calling operations for you, the class name of an operation more and becomes a thing not to worry about.</p>

<p>Many projects use Trailblazer along with the Rails naming convention now. This means you can disable the loader gem, and benefit from Rails auto-magic behavior such as faster loading in the “correct” order, reloading and all the flaws that come with this non-deterministic behavior.</p>

<p>As a first step, add <code>Operation</code> to your operation’s class name, matching the Rails naming convention.</p>

<pre><code># app/concepts/product/operation/create.rb

module Product::Operation
  class Create &lt; Trailblazer::Operation
    # ...
  end
end
</code></pre>

<p>It’s a Trailblazer convention to put <code>[ConceptName]::Operation</code> in one line: it will force Rails to load the concept name constant, so you don’t have to reopen the class yourself.</p>

<p>This will result in a class name <code>Product::Operation::Create</code>.</p>

<p>Next, disable the loader gem, in <code>config/initializers/trailblazer.rb</code>.</p>

<pre><code># config/initializers/trailblazer.rb

YourApp::Application.config.trailblazer.enable_loader = false
</code></pre>

<p>Trailblazer files will now be loaded by Rails - you need to follow the Rails autoloading file naming from here on, and things should run smoothly. A nice side-effect here is that in bigger projects (with hundreds of operations), the start-up time in development accelerates significantly.</p>

<div class="bd-callout bd-callout-info">
<p>The infamous <code>warning: toplevel constant Cell referenced by Notification::Cell</code> warning <a href="https://blog.bigbinary.com/2017/10/18/ruby-2.5-has-removed-top-level-constant-lookup.html">is a bug in Ruby</a>. You should upgrade to Ruby &gt;= 2.5.</p>

</div>

</div>

                <aside>
                  <span class="deco-purple-cross wow fadeIn"></span>
                </aside>
              </main>

              <div class="d-none d-xl-block doc-xl-2 list-group sidebar-scroll order-3">
                <img alt="Trailblazer" class="wow fadeIn" src="/vite/assets/deco1.51110a75.webp" />
                <div class="features" id="rails-integration-controller-features">
  <h3 class="mt-0">
    <i class="fas fa-times"></i>
    <span>Controller</span>
  </h3>

  <ul class="vertical menu">
    
      <li>
        <a href="#rails-integration-controller-manual-invoke">
          <i class="fas fa-arrow-right"></i>
          Manual invoke
        </a>
      </li>
      
    
      <li>
        <a href="#rails-integration-controller-run">
          <i class="fas fa-arrow-right"></i>
          Run
        </a>
      </li>
      
        
        <li class="sub-item">
          <a href="#rails-integration-controller-run-block-syntax">Block syntax</a>
        </li>
      
        
        <li class="sub-item">
          <a href="#rails-integration-controller-run-keyword-arguments">Keyword arguments</a>
        </li>
      
        
        <li class="sub-item">
          <a href="#rails-integration-controller-run-runtime-variables">Runtime variables</a>
        </li>
      
        
        <li class="sub-item">
          <a href="#rails-integration-controller-run-run-options">Run Options</a>
        </li>
      
    
      <li>
        <a href="#rails-integration-controller-endpoint">
          <i class="fas fa-arrow-right"></i>
          Endpoint
        </a>
      </li>
      
    
  </ul>
</div>

<div class="features" id="rails-integration-cells-features">
  <h3 class="mt-0">
    <i class="fas fa-times"></i>
    <span>Cells</span>
  </h3>

  <ul class="vertical menu">
    
      <li>
        <a href="#rails-integration-cells-file-structure">
          <i class="fas fa-arrow-right"></i>
          File structure
        </a>
      </li>
      
    
      <li>
        <a href="#rails-integration-cells-render">
          <i class="fas fa-arrow-right"></i>
          Render
        </a>
      </li>
      
        
        <li class="sub-item">
          <a href="#rails-integration-cells-render-skip-controller-layout">Skip controller layout</a>
        </li>
      
        
        <li class="sub-item">
          <a href="#rails-integration-cells-render-cell-options">Cell options</a>
        </li>
      
    
      <li>
        <a href="#rails-integration-cells-configuration">
          <i class="fas fa-arrow-right"></i>
          Configuration
        </a>
      </li>
      
    
  </ul>
</div>

<div class="features" id="rails-integration-reform-features">
  <h3 class="mt-0">
    <i class="fas fa-times"></i>
    <span>Reform</span>
  </h3>

  <ul class="vertical menu">
    
  </ul>
</div>

<div class="features" id="rails-integration-loader-features">
  <h3 class="mt-0">
    <i class="fas fa-times"></i>
    <span>Loader</span>
  </h3>

  <ul class="vertical menu">
    
      <li>
        <a href="#rails-integration-loader-loader-with-rails">
          <i class="fas fa-arrow-right"></i>
          Loader with Rails
        </a>
      </li>
      
    
  </ul>
</div>

              </div>
            </div>
          </div>
        </section>
      </main>

      <footer class="trailblazer-footer">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-3 col-lg-2">
        <a href="/2.1/index.html" class="logo-footer">Trailblazer</a>
      </div>
      <div class="col-md-6 col-lg-8">
        <nav>
          <ul class="navbar-nav documentation-nav-items">
  <li>
    <a class="nav-item nav-link active" href="/2.1/docs/trailblazer.html">
      <i class="fas fa-arrow-right"></i>
      DOCS
    </a>
  </li>

  <li>
    <a class="nav-item nav-link " href="https://dev.to/trailblazer">BLOG</a>
  </li>

  <li class="">
    <a class="nav-item nav-link " href="/2.1/about_us.html">ABOUT US</a>
  </li>

  <li>
    <a class="nav-item nav-link " href="/2.1/learn.html">LEARN</a>
  </li>

  <li class="">
    <a class="nav-item nav-link" href="/2.0/index.html">
      <i class="fas fa-arrow-right"></i>
      2.0
    </a>
  </li>

  <li>
    <a class="nav-item nav-link" href="https://trailblazer.zulipchat.com" target="_blank">
      <i class="fas fa-comments"></i>
      CHAT
    </a>
  </li>

  <!--
  
  -->
</ul>

        </nav>
      </div>
      <div class="col-md-3 col-lg-2">
        <ul class="social purple">
          <li>
            <a href="https://github.com/trailblazer" target="_blank"><i class="fab fa-github-square"></i></a>
          </li>
          <li>
            <a href="https://www.facebook.com/trailblazer.to" target="_blank"><i class="fab fa-facebook-square"></i></a>
          </li>
          <li>
            <a href="https://twitter.com/trailblazer_to" target="_blank"><i class="fab fa-twitter-square"></i></a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    </div>
  </body>
</html>
